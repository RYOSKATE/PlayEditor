@*
* This template takes a single argument, a String containing a
* message to display.
*@
@(message: String)
@*
* Call the `main` template with two arguments. The first
* argument is a `String` with the title of the page, the second
* argument is an `Html` object containing the body of the page.
*@
@main("Welcome to Play") {
    <style>
    .level2 {
        visibility: hidden;
        padding-left: 20px
    }

    </style>
    @*
    * Get an `Html` object by calling the built-in Play welcome
    * template and passing a `String` message.
    *@
    @*
    @play20.welcome(message, style = "Scala")
    *@
    <div id = "logo">
        <img src="@routes.Assets.versioned("images/Jasmine.png")" width="300" height="88">
    </div>

    <div>
        <button id="submit" class="btn btn-default" onclick="document.getElementById('answer').style.visibility = 'visible';
        document.getElementById('answer').style.display = 'block';"> Submit </button>
        <button id="prev" class="btn btn-default"> Previous </button>
        <button id="next" class="btn btn-default"> Next </button>
    </div>
    <div width="500px" height="800px"><pre id = quiz width="500px" height="800px"></pre></div>
    <div id = "editorAnswer" style="height: 400px;
        width: 500px;
        float: left;
        padding-right: 250px;"></div>


    <div id="answer" width="500px" height="400px" style="float: right;
        visibility: hidden;
        padding-bottom: 100px">
        <img id = "task1ans" src="@routes.Assets.versioned("images/task1.png")">
    </div>

    <div id="choices" style="padding-top: 20px;
        padding-bottom: 300px;
        float: left">
        <form>
            <input id="choice1" name="choice" class="level1" type="radio"><label id="A"></label><br>
            <input id="choice2" name="choice" class="level1" type="radio"><label id="B"></label><br>
            <input id="choice3" name="choice" class="level1" type="radio"><label id="C"></label><br>
            <input id="choice4" name="choice" class="level1" type="radio"><label id="D"></label><br>
        </form>


    </div>
    @* Converter in the bottom *@
    <div id = "tool" style="background-color: white;
        position: fixed;
        bottom: 0;
        border: solid;
        height: 250px;
        width: 90%;
        z-index: 10;
        float: left">

        <div clsee="row">
            @*CodeArea(ACE)*@
            <div class="btn-group" style="background-color: whitesmoke;
                margin-top: 20px;
                margin-left: 15px;
                width: 975px">
                @*<div class="btn-group">*@
                @*<button class="btn btn-default dropdown-toggle" data-toggle="dropdown"><i class="glyphicon glyphicon-search"></i> <span class="caret"></span></button>*@
                @*<ul class="dropdown-menu" id="font-size">*@
                @*<li><a href="#" data-size="10">小さい</a></li>*@
                @*<li><a href="#" data-size="12">普通</a></li>*@
                @*<li><a href="#" data-size="14">大きい</a></li>*@
                @*</ul>*@
                @*</div>*@
                @*<button id="bold" class="btn btn-default"><i class="glyphicon glyphicon-bold"></i></button>*@
                @*<button id="save" class="btn btn-default"><i class="glyphicon glyphicon-floppy-save"></i></button>*@
                @*<button id="load" class="btn btn-default"><i class="glyphicon glyphicon-folder-open"></i></button>*@
                <button id="exec" class="btn btn-default"><i class="glyphicon glyphicon-play"></i></button>
                <button id="close" class="btn btn-default"><i class="glyphicon glyphicon-menu-down"></i></button>
                @*<button id="step" class="btn btn-default"><i class="glyphicon glyphicon-arrow-down"></i></button>*@
            </div>

        </div>
        <div id="converter" style="height: 180px;
            overflow: auto">
            <div class="col-lg-6 col-md-6">
                Java
                <div id="editorMain" style="height: 600px"></div>

            </div>
            <div class="col-lg-6 col-md-6">
                Swift
                <div id="editorResult" style="height: 600px"></div>
            </div>
        </div>
    </div>
    @*処理の流れ<br>*@
    @*実行ボタン：JavaScriptでイベント取得。エディタ上のテキストを取得。Fromの形でPOST(JavaScript)<br>*@
    @*コントローラはポストされたデータを取得。アクション関数で文字列の処理など。(Scala,String)ビューにセット。<br>*@
    @*ビュー：生文字を取得(改行文字に注意)。JavaScriptでコメント文字など操作してセット。<br>*@
    <script>

            $('#close').on('click', function () {
                var curHeight = $('#tool').height();
                if (curHeight > 200) {//appeared
                    $('#tool').animate({
                        height: 70
                    }, "normal");
                    $('#converter').fadeOut();
                } else {
                    $('#tool').animate({
                        height: 250
                    }, "normal");
                    $('#converter').fadeIn();
                }
            });
            let tasks = ["問１。以下のforループはSwift1.0の時のものです。それを今のSwift文法を用いて、もっと簡潔な方法で宣言してください。<br>" +
            `
for var i = 0; i<5; i++{
	print("Hello!")
}
                `,
                "問２。二つの引数の値を交換するswap(Int, Int)を実装してくださあい。<br>",
                "問３。一つの文字列が回文かどうかを判断するメソットを実装してください。回文であればtrue, そうでなければfalseを返してください。<br>",
                "問４。ソートされた数字の配列から重複している要素を消すメソット実装してください。最後、重複している要素のない配列の長さを返してください。<br>"
            ];
            let questions = ["問１。以下のSwiftコードを読んで、出力を選択ください。<br>" +
            `
 class Address {
    var fullAddress:String
    var city:String
    init(fullAddress:String, city:String){
        self.fullAddress = fullAddress
        self.city = city
    }
 }

 class Person{
    var name:String
    var address:Address

    init(name:String, address:Address){
        self.name = name
        self.address = address
    }
 }
 var headquarters = Address(fullAddress:"123 Tutorial Street", city:"Appletown")
 var ray = Person(name:"Ray", address:headquarters)
 var brain = Person(name:"Brain", address:headquarters)

もしbrainが隣の街に引っ越して、住所を変更したい場合、

brain.address.fullAddress = "148 Tutorial Street"

このコードに関して、以下のどれが正しいですか？
                     `,

                "問２。以下の二つのif文の実行結果に関して、正しい結論はどれですか？その理由はなんですか？。<br>" +
                `
let i = 101

if case 100...101 = i {
    print("Hello, world!")
} else {
    print("Goodbye, world!")
}

if case 100..<101 = i {
    print("Hello, world!")
} else {
    print("Goodbye, world!")
}

                     `,
                "問３。次のコードの実行結果に関して正しいのはどれですか？その理由はなんですか？。<br>" +
                `
let names = ["River", "Kaylee", "Zoe"]
let result = names.sort { $0 > $1 }
print(result)

                     `,

                "問４。次のコードの実行結果に関して正しいのはどれですか？その理由はなんですか？<br>" +
                `
func printMonth(firstDay:Int, days:Int){
    func daysstr(d:Int) -> String{
        if d<=0{
            return "    "
        }else{
            return (d<10 ? \"  \\(d)\": \"  \\(d)\")
        }
    }
    var d = 1-firstDay
    while d<=days{
        var line = ""
        for i in 0..<7 {
            line+=daysstr(d)
            d=d+1
            if d > days{
                break
            }
        }
        print(line)
    }
}
printMonth(0,days:31)

                  `,
                "問５。tutorial1.difficultyとtutorial2.difficultyの値は何ですか？また、Tutorialがstructではなく、classだったら二つの値は何ですか？<br>" +
                `
struct Tutorial {
  var difficulty: Int = 1
}

var tutorial1 = Tutorial()
var tutorial2 = tutorial1
tutorial2.difficulty = 2

                `,
                "問6。以下のコードの実行結果に関して正しい結論はどれですか？<br>" + `
let year : Int? = Int("2020")
let remain : Int = year! - 2016

let year2 : Int? = nil
let remain2 : Int = year! - 2016

let year3 : Int? = nil
if let remain3 = year3 {
    print("remain \\(remain3)years")
}
                `,
                "問7。以下のコードの実行結果に関して正しい結論はどれですか？<br>" +
                `
let i = 11
let j = 20

let name = 9...11 ~= i ? j % 2 == 1 ? "Larry" : "Laura" : "Libby"
                            `,
                "問８。以下のコードの正しい実行結果はなんですか？<br>" +
                `
var crew = ["Caption": "Malcom", "Doctor": "Simon"]
crew = [:]
print(crew.count)
                            `,
                "問９。以下のコードの正しい実行結果はなんですか？<br>" +
                `
 let d:Double = 0.5
 let f:Float = r
                            `,
                "問１０。以下のコードの正しい１０個結果はなんですか？<br>" +
                `
enum Weather {
    case Sunny
    case Cloudy
    case Windy(speed: Int)
}
let today: Weather = .Windy(speed: 10)

switch today {
case .Sunny, .Cloudy:
    print("It's not that windy")
case .Windy(let speed) where speed >= 10:
    print("It's very windy")
default:
    print("It's a bit windy")
}
                            `
            ];
            let ans1s = ["Decimal",
                "Double",
                "Float",
                "Compile error"
            ];
            let ans3s = ["[\"Kaylee\", \"River\", \"Zoe\"]",
                "[\"Kaylee\"]",
                "[\"Zoe\", \"River\", \"Kaylee\"]",
                "[\"Zoe\"]"
            ];
            let ans6s = [];
            let ans7s = ["\"\"",
                "Larry",
                "Laura",
                "Libby"
            ];
            let ans8s = ["0",
                "1",
                "2",
                "3"
            ];
            let ans9s = ["0.5",
                "0.0",
                "0",
                "Compile error"
            ];
            let ans10s = ["\"It's a bit windy\"",
                "\"It's not that windy\"",
                "\"It's very windy\"",
                "Nothing will output"
            ];

            let startEnd = "THE END OF START";
            let endEnd = "THE END OF THE QUESTIONS, IF YOU ARE READY TO GET THE TEST, PLEASE GO TO THIS WEBSITE:";
            localStorage.currentTask = questions[0];
            document.getElementById('quiz').innerHTML = questions[0];
            $('#answer').hide();
            document.getElementById('A').innerHTML = ans1s[0];
            document.getElementById('B').innerHTML = ans1s[1];
            document.getElementById('C').innerHTML = ans1s[2];
            document.getElementById('D').innerHTML = ans1s[3];

            if (localStorage.currentTask != tasks[0]
                    && localStorage.currentTask != tasks[1]
                    && localStorage.currentTask != tasks[2]
            ) {
                $('#editorAnswer').hide();
            } else {
                document.getElementById('editorAnswer').style.display = 'block'
                document.getElementById('editorAnswer').style.visibility = 'visible';
            }


            $('#next').on('click', function () {
                $('#answer').hide();
                if (localStorage.currentTask == startEnd) {
                    document.getElementById('quiz').innerHTML = questions[0];
                    localStorage.currentTask = questions[0];

                }
                else if (localStorage.currentTask == questions[questions.length - 1]) {
                    document.getElementById('quiz').innerHTML = tasks[0];
                    localStorage.currentTask = tasks[0];
                    $('#choices').hide();
                    document.getElementById('editorAnswer').style.display = 'block';
                }
                else if (localStorage.currentTask == tasks[tasks.length - 1]) {
                    document.getElementById('quiz').innerHTML = endEnd;
                    localStorage.currentTask = endEnd;
                    $('#choices').hide();
                    $('#editorAnswer').hide();

                }
                else {
                    for (var i = 0; i < questions.length - 1; i++) {
                        if (localStorage.currentTask == questions[i]) {
                            document.getElementById('quiz').innerHTML = questions[i + 1];
                            localStorage.currentTask = questions[i + 1];
                            $('#choices').show();
                            break;
                        }
                    }
                    for (var i = 0; i < tasks.length - 1; i++) {
                        if (localStorage.currentTask == tasks[i]) {
                            document.getElementById('quiz').innerHTML = tasks[i + 1];
                            localStorage.currentTask = tasks[i + 1];
                            $('#choices').hide();
                            document.getElementById('editorAnswer').style.display = 'block';
                            break;
                        }
                    }
                }
            });
            $('#prev').on('click', function () {
                $('#answer').hide();

                if (localStorage.currentTask == questions[0]) {
                    document.getElementById('quiz').innerHTML = startEnd;
                    localStorage.currentTask = startEnd;

                }
                else if (localStorage.currentTask == endEnd) {
                    document.getElementById('quiz').innerHTML = tasks[tasks.length - 1];
                    localStorage.currentTask = tasks[tasks.length - 1];
                    document.getElementById('editorAnswer').style.display = 'block';
                }
                else if (localStorage.currentTask == tasks[0]) {
                    document.getElementById('quiz').innerHTML = questions[questions.length - 1];
                    localStorage.currentTask = questions[questions.length - 1];
                    document.getElementById('choices').style.display = 'block';
                    $('#editorAnswer').hide();

                }
                else {
                    for (var i = 1; i < questions.length; i++) {
                        if (localStorage.currentTask == questions[i]) {
                            document.getElementById('quiz').innerHTML = questions[i - 1];
                            localStorage.currentTask = questions[i - 1];
                            $('#choices').show();
                            break;
                        }
                    }
                    for (var i = 1; i < tasks.length; i++) {
                        if (localStorage.currentTask == tasks[i]) {
                            document.getElementById('quiz').innerHTML = tasks[i - 1];
                            localStorage.currentTask = tasks[i - 1];
                            $('#choices').hide();
                            document.getElementById('editorAnswer').style.display = 'block';
                            break;
                        }
                    }
                }
            })
            function createEditor(idName, canWrite, initText, mode, AnsEditor) {
                var editor = ace.edit(idName);
                if (canWrite) {
                    editor.$blockScrolling = Infinity;
                    editor.setOptions({
                        enableBasicAutocompletion: true,//基本的な自動補完
                        enableSnippets: true,//スニペット
                        enableLiveAutocompletion: true//ライブ補完
                    });
                }
                editor.setTheme("ace/theme/monokai");
                editor.getSession().setMode("ace/mode/" + mode);//シンタックスハイライトと自動補完
                //editor.getSession().setUseWrapMode(true);//true:折り返し、false:横スクロールバー
                //2の場合編集不可能オプションをtrueにしたい。ｌ
//                $('#font-size').click(function (e) {
//                    editor.setFontSize($(e.target).data('size'));
//                });
                editor.setReadOnly(!canWrite);
                if (canWrite) {
                    $('#exec').click(function (e) {
                        var form = document.createElement('form');
                        document.body.appendChild(form);
                        var input = document.createElement('input');
                        input.setAttribute('type', 'hidden');
                        input.setAttribute('name', 'name');
                        var text = editor.getValue();
//                    text = text.split(`"`).join(`"`);

                        if (idName == 'editorMain') {
                            if (AnsEditor != null) {
                                localStorage.textSwiftAns = AnsEditor.getValue();
                            }
                            localStorage.textJavaMain = text;
                            input.setAttribute('value', text);
                            form.appendChild(input);
                            form.setAttribute('action', '/converter');
                            form.setAttribute('method', 'POST');
                            form.submit();

                        }
                    });
                }
                if (initText != null && initText != '')
                    editor.setValue(initText, -1);
                return editor;
            }
            var mes = `@Html(message)`;
            var mes1 = mes.replace(/<br>/g, `
`) ;
            var mes2 = mes.replace(/<br>/g, `
//`) ;
            if (mes2 == "NULL_POINTER") {
                alert("Error in the Java Program");
                mes2 = "";
            }

            var editorAnswer = createEditor('editorAnswer', true, localStorage.textSwiftAns, "swift", null);
            var editorMain = createEditor('editorMain', true, localStorage.textJavaMain, "java", editorAnswer);
            var editorResult = createEditor('editorResult', false, mes2, "swift", null);
    </script>
}