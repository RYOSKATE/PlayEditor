
@*
* This template takes a single argument, a String containing a
* message to display.
*@
@(message: String,tree:String)

@*
* Call the `main` template with two arguments. The first
* argument is a `String` with the title of the page, the second
* argument is an `Html` object containing the body of the page.
*@
@main("Welcome to Play") {
    @*
    * Get an `Html` object by calling the built-in Play welcome
    * template and passing a `String` message.
    *@
    @*
    @play20.welcome(message, style = "Scala")
    *@
    <div clsee="row">
        CodeArea(ACE)
        <div class="btn-group">
            <div class="btn-group">
                <button class="btn btn-default dropdown-toggle" data-toggle="dropdown"><i class="glyphicon glyphicon-search"></i> <span class="caret"></span></button>
                <ul class="dropdown-menu" id="font-size">
                    <li><a href="#" data-size="10">小さい</a></li>
                    <li><a href="#" data-size="12">普通</a></li>
                    <li><a href="#" data-size="14">大きい</a></li>
                </ul>
            </div>
            @*<button id="bold" class="btn btn-default"><i class="glyphicon glyphicon-bold"></i></button>*@
            @*<button id="save" class="btn btn-default"><i class="glyphicon glyphicon-floppy-save"></i></button>*@
            @*<button id="load" class="btn btn-default"><i class="glyphicon glyphicon-folder-open"></i></button>*@
            <button id="exec" class="btn btn-default"><i class="glyphicon glyphicon-play"></i></button>
            <button id="step" class="btn btn-default"><i class="glyphicon glyphicon-arrow-down"></i></button>
        </div>
    </div>
    <div clsee="row">
    <div class="col-lg-6 col-md-6">
        before
        <div id="editorMain" style="height: 600px"></div>
    </div>
    <div class="col-lg-6 col-md-6">
        <canvas id="display" width="600px" height="720px"></canvas>
    </div>
    <div class="col-lg-12 col-md-12">
    処理の流れ<br>
    実行ボタン：JavaScriptでイベント取得。エディタ上のテキストを取得。Fromの形でPOST(JavaScript)<br>
    コントローラはポストされたデータを取得。アクション関数で文字列の処理など。(Scala,String)ビューにセット。<br>
    ビュー：生文字を取得(改行文字に注意)。JavaScriptでコメント文字など操作してセット。<br>
    </div>
    </div>
    <script>
        function createEditor(idName,canWrite,initText) {
            var editor = ace.edit(idName);
            if (canWrite) {
                editor.$blockScrolling = Infinity;
                editor.setOptions({
                    enableBasicAutocompletion: true,//基本的な自動補完
                    enableSnippets: true,//スニペット
                    enableLiveAutocompletion: true//ライブ補完
                });
            }
            editor.setTheme("ace/theme/monokai");
            editor.getSession().setMode("ace/mode/c_cpp");//シンタックスハイライトと自動補完
            //editor.getSession().setUseWrapMode(true);//true:折り返し、false:横スクロールバー


            $('#font-size').click(function (e) {
                editor.setFontSize($(e.target).data('size'));
            });

            editor.setReadOnly(!canWrite);
            if (canWrite) {
                $('#exec').click(function (e) {
                    var form = document.createElement('form');
                    document.body.appendChild(form);
                    var input = document.createElement('input');
                    input.setAttribute('type', 'hidden');
                    input.setAttribute('name', 'name');
                    var text = editor.getValue();//ここでは生文字の改行だがPOSTしてコントローラーでは改行文字になっている。
                    localStorage.text = text;
                    var ln = `
`;
                    var regExp = new RegExp( ln, "g" ) ;
                    var text = text.replace(regExp, ' ') ;//エディタの改行は全て空白に置換する
                    input.setAttribute('value', text);
                    form.appendChild(input);
                    form.setAttribute('action', '/visualizer');
                    form.setAttribute('method', 'POST');
                    form.submit();
                });

                $('#step').click(function (e) {
                    //var obj = editor.getCursorPosition();
                    //var pos = editor.getCursorPositionScreen();
                    var curpos = editor.getSelection().getCursor();//1現在の位置
                    editor.gotoLine(curpos.row+1 , curpos.column); //1行列目が1
                    editor.getSelection().selectLine();
                });
            }

            if (initText != '')
                editor.setValue(initText, -1);
        }
/*
        var mes =`@Html(message)`;
        var mes2 = '// '+ mes.replace( /<br>/g , `
//`) ;
*/
        createEditor('editorMain',true,localStorage.text);
        //createEditor('editorResult',false,mes);
        var treeJson =`[` + `@Html(tree)` + `]`;
        var treeObj = JSON.parse(treeJson);
        var data = new Array(treeObj);
        //var data.push();

    </script>
    <script src="@routes.Assets.versioned("javascripts/visualizer.js")" type="text/javascript"></script>
}