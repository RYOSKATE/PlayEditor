
@*
* This template takes two arguments,
* a String containing a message to display.
* the other string to store the answer
*@
@(message: String)

@*
* Call the `main` template with two arguments. The first
* argument is a `String` with the title of the page, the second
* argument is an `Html` object containing the body of the page.
*@
@main("Welcome to Play") {
    @*
    * Get an `Html` object by calling the built-in Play welcome
    * template and passing a `String` message.
    *@
    @*
    @play20.welcome(message, style = "Scala")
    *@
    <div id = "logo">
        <img src="@routes.Assets.versioned("images/Jasmine.png")" width="300" height="88">

    </div>
    <div style="padding-bottom: 100px">

        @* Question area*@
    <p>問１。ある時をあたえられた時、長針と短針間の角度を計算してください</p>
        <button> Submit </button>
        <button> Next </button>

        <div id = "editorAnswer" style="height:400px;width:500px;margin-bottom: 100px"></div>


    @* Converter in the bottom *@
    <div id = "tool" style="background-color:white;position:fixed;bottom:0;border:solid;height:250px;width:1000px;z-index:10">

        <div id = "buttons" clsee="row">
        @*CodeArea(ACE)*@
            <div class="btn-group" style="background-color:whitesmoke;margin-top:20px;margin-left:15px;width:975px">
            @*<div class="btn-group">*@
                @*<button class="btn btn-default dropdown-toggle" data-toggle="dropdown"><i class="glyphicon glyphicon-search"></i> <span class="caret"></span></button>*@
                @*<ul class="dropdown-menu" id="font-size">*@
                    @*<li><a href="#" data-size="10">小さい</a></li>*@
                    @*<li><a href="#" data-size="12">普通</a></li>*@
                    @*<li><a href="#" data-size="14">大きい</a></li>*@
                @*</ul>*@
            @*</div>*@
            @*<button id="bold" class="btn btn-default"><i class="glyphicon glyphicon-bold"></i></button>*@
            @*<button id="save" class="btn btn-default"><i class="glyphicon glyphicon-floppy-save"></i></button>*@
            @*<button id="load" class="btn btn-default"><i class="glyphicon glyphicon-folder-open"></i></button>*@
            <button id="exec" class="btn btn-default"><i class="glyphicon glyphicon-play"></i></button>
            <button id="close" class="btn btn-default"><i class="glyphicon glyphicon-menu-down"></i></button>
            @*<button id="step" class="btn btn-default"><i class="glyphicon glyphicon-arrow-down"></i></button>*@
            </div>
        </div>
        <div id="converter" style="height:180px;overflow:auto">
            <div class="col-lg-6 col-md-6">
                Java
                <div id="editorMain" style="height:400px"></div>
            </div>
            <div class="col-lg-6 col-md-6">
                Swift(ReadOnly)
                <div id="editorResult" style="height:400px"></div>
            </div>
        </div>

    </div>
        </div>

    @*処理の流れ<br>*@
    @*実行ボタン：JavaScriptでイベント取得。エディタ上のテキストを取得。Fromの形でPOST(JavaScript)<br>*@
    @*コントローラはポストされたデータを取得。アクション関数で文字列の処理など。(Scala,String)ビューにセット。<br>*@
    @*ビュー：生文字を取得(改行文字に注意)。JavaScriptでコメント文字など操作してセット。<br>*@
    <script>

            $('#close').on('click',function(){
                var curHeight = $('#tool').height();
                if(curHeight > 200){//appeared
                    $('#tool').animate({
                        height: 70
                    }, "normal");
                    $('#converter').fadeOut();
                }else{
                    $('#tool').animate({
                        height: 250
                    }, "normal");
                    $('#converter').fadeIn();
                }
            });

        function createEditor(idName,canWrite,initText,mode) {
            var editor = ace.edit(idName);
            if (canWrite) {
                editor.$blockScrolling = Infinity;
                editor.setOptions({
                    enableBasicAutocompletion: true,//基本的な自動補完
                    enableSnippets: true,//スニペット
                    enableLiveAutocompletion: true//ライブ補完
                });
            }
            editor.setTheme("ace/theme/monokai");
            editor.getSession().setMode("ace/mode/"+mode);//シンタックスハイライトと自動補完
            //editor.getSession().setUseWrapMode(true);//true:折り返し、false:横スクロールバー

            //2の場合編集不可能オプションをtrueにしたい。ｌ

            $('#font-size').click(function (e) {
                editor.setFontSize($(e.target).data('size'));
            });

            editor.setReadOnly(!canWrite);
            if (canWrite) {
                $('#exec').click(function (e) {
                    var form = document.createElement('form');
                    document.body.appendChild(form);
                    var input = document.createElement('input');
                    input.setAttribute('type', 'hidden');
                    input.setAttribute('name', 'name');
                    var text = editor.getValue();
//                    text = text.split(`"`).join(`"`);
                    localStorage.text = text;
                    input.setAttribute('value', text);
                    form.appendChild(input);
                    form.setAttribute('action', '/converter');
                    form.setAttribute('method', 'POST');
                    form.submit();
                });

                $('#step').click(function (e) {
                    //var obj = editor.getCursorPosition();
                    //var pos = editor.getCursorPositionScreen();
                    var curpos = editor.getSelection().getCursor();
                    editor.gotoLine(curpos.row+2 , curpos.column); //1行列目が1
                });
            }


            if (initText != '')
                editor.setValue(initText, -1);
        }
        var mes =`@Html(message)`;
        var mes1 = mes.replace( /<br>/g , `
`) ;
        var mes2 =  mes.replace( /<br>/g , `
//`) ;
        if(mes2 == "NULL_POINTER"){
            alert("Error in the Java Program");
            mes2 = "";
        }
        createEditor('editorMain',true,localStorage.text,"java");
        createEditor('editorResult',false,mes2,"swift");
        createEditor('editorAnswer',true,localStorage.text,"swift")
    </script>

}
